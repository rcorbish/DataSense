<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel='stylesheet' href='css.css'>

<style>
</style>

<title>zudat</title>
</head>
<body>
	<div class="upload" data-target='upload-data'>Drop CSV</div>
	<div class="controls">
		<form class='control' accept-charset="UTF-8" >
			<input type='checkbox' name='square-values'>Synthesize x<sup>2</sup>
			<input type='checkbox' name='discrete-to-col'>Discrete column values for labels
			<input type='radio'    name='date-treatment' value='to-year'>Dates to years
			<input type='radio'    name='date-treatment' value='to-months'>Dates to month
			<input type='radio'    name='date-treatment' value='to-days'>Dates to days
			<input type='radio'    name='date-baseline'  value='today' >Baseline for dates is today
			<input type='radio'    name='date-baseline'  value='1900' >Baseline for dates is 01-Jan-1900
			<input type='radio'    name='date-baseline'  value='2000' >Baseline for dates is 01-Jan-2000
			<input type='radio'    name='method' value='linear' checked>Linear Regression
			<input type='radio'    name='method' value='logistic' >Logistic Regression
			<input type='radio'    name='method' value='centroids' >Nearest Centroid
			<input type='radio'    name='method' value='correlation' >Correlation
			<input type='radio'    name='method' value='statistics' >Statistics
		</form>
	</div>
	<div id="results"> </div>

	<script>
		window.addEventListener("load", function(e) {
			initUploadDivs()
		});

		function initUploadDivs() {
			var divs = document.querySelectorAll(".upload");
			var div;
			for (var i = 0; i < divs.length; i++) {
				div = divs[i];
				div.ondragover = function(e) {
					e.dataTransfer.dropEffect = 'copy';
					this.classList.add( "dropok" ) ;
					e.preventDefault();
					return false;
				}.bind(div);
				div.ondragend = function(e) {
					this.classList.remove( "dropok" ) ;
					e.preventDefault();
					return false;
				};
				div.ondragleave = function(e) {
					this.classList.remove( "dropok" ) ;
					e.preventDefault();
					return false;
				};
				div.ondrop = function(e) {
					this.innerHTML = "Uploading ...." 
					
					//const query = buildQuery() 
					
					this.classList.remove( "dropok" ) 
					e.preventDefault()
					
					uploadFile( e.dataTransfer.files[0], this.dataset.target, this )
					return false
				}.bind( div ) ;
			}
		}
		
		function uploadFile( file, target, div ) {
			// Will upload and send the controls info 
			// 
			const form = document.querySelector( ".control" ) ;
			var formData = new FormData( form );
			formData.append( file.name, file ) ;
			var xhr = new XMLHttpRequest();
			xhr.onload = function(e) {
				div.innerHTML = "Drop CSV" ;
				document.getElementById("results").innerHTML = "<pre>"
						+ e.target.responseText + "</pre>";
			} ;
			xhr.onerror = function(e) {
				div.innerHTML = "Drop CSV" ;
				document.getElementById("results").innerHTML = "<pre>"
						+ e.target.responseText + "</pre>";
			} ;
			xhr.open("POST", target);
			xhr.send(formData);			
		}
		
	</script>
</body>
</html>