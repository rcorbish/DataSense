<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<link rel='stylesheet' href='./css.css'>
<style>
</style> 

<title>zudat</title>
</head>
<body>
	<div id='menu-group' class='controls'>
		<div class="hamburger collapsible">
			<div class="collapsible bar1"></div>
			<div class="collapsible bar2"></div>
			<div class="collapsible bar3"></div>
		</div>

		<div id="menu" class="collapsible menu" >
			<div class="upload" data-target='upload-data'>Drop CSV</div>
			<form class='control' accept-charset="UTF-8" >
				<input type='checkbox' name='square-values'>Synthesize x<sup>2</sup>
				<input type='checkbox' name='log-values'>Synthesize log<sub>e</sub>( 1 + x<sup>2</sup> )
				<input type='checkbox' name='reciprocal'>Synthesize 1 / ( 1 + x )
				<input type='checkbox' name='discrete-to-col'>Discrete labels
				<input type='checkbox' name='keep-original'>Keep original labels
				<input type='radio'    name='date-treatment' value='to-year'>Dates to years
				<input type='radio'    name='date-treatment' value='to-months'>Dates to month
				<input type='radio'    name='date-treatment' value='to-days'>Dates to days
				<input type='radio'    name='date-baseline'  value='today' >Baseline for dates is today
				<input type='radio'    name='date-baseline'  value='1900' >Baseline for dates is 01-Jan-1900
				<input type='radio'    name='date-baseline'  value='2000' >Baseline for dates is 01-Jan-2000
				<input type='radio'    name='method' value='svmc' checked>SVM-C
				<input type='radio'    name='method' value='svmr' checked>SVM-R
				<input type='radio'    name='method' value='linear' checked>Linear Regression
				<input type='radio'    name='method' value='logistic' >Logistic Regression
				<input type='radio'    name='method' value='centroids' >Nearest Centroid
				<input type='radio'    name='method' value='correlation' >Correlation
				<input type='radio'    name='method' value='statistics' >Statistics
			</form>
		</div>
	</div>

	<div id="results"> </div>

	<script>
		window.addEventListener("load", function(e) {
			initUploadDivs()
			const menuGroup = document.getElementById( "menu-group" ) ;
			const menuHamburger = menuGroup.querySelector( ".hamburger" ) ;

			menuHamburger.addEventListener( "click", function(e) {
			const collapsibles = menuGroup.querySelectorAll( ".collapsible" ) ;
			for( var i=0 ; i<collapsibles.length ; i++ ) {
				collapsibles[i].classList.toggle("expanded");
			}
			}) ;
		});

		function initUploadDivs() {
			var divs = document.querySelectorAll(".upload");
			var div;
			for (var i = 0; i < divs.length; i++) {
				div = divs[i];
				div.ondragover = function(e) {
					console.log( "Drag:", e ) ;
					e.dataTransfer.dropEffect = 'copy';
					this.classList.add( "dropok" ) ;
					e.preventDefault();
					return false;
				};
				div.ondragend = function(e) {
					this.classList.remove( "dropok" ) ;
					e.preventDefault();
					return false;
				};
				div.ondragleave = function(e) {
					this.classList.remove( "dropok" ) ;
					e.preventDefault();
					return false;
				};
				div.ondrop = function(e) {
					this.innerHTML = "Uploading ...." 
					this.classList.add( "active" ) 
					//const query = buildQuery() 
					
					this.classList.remove( "dropok" ) 
					e.preventDefault()
					
					var u = e.dataTransfer.getData('url' ) ;
					if( u ) {
						document.getElementById("results").innerHTML = "Uploading urls like " + u + " isn't supported yet" ;						console.log( "Uploaded a url", u ) ;
						this.innerHTML = "Drop CSV" 
						this.classList.remove( "active" )
					} else {
						uploadFile( e.dataTransfer.files[0], this.dataset.target, this )
					}
					return false
				}.bind( div ) ;
			}
		}
		
		function uploadFile( file, target, div ) {
			// Will upload and send the controls info 
			// 
			const form = document.querySelector( ".control" ) ;
			var formData = new FormData( form );
			formData.append( file.name, file ) ;
			var xhr = new XMLHttpRequest();
			xhr.onload = function(e) {
				div.innerHTML = "Drop CSV" ;
				div.classList.remove( "active" )
				document.getElementById("results").innerHTML = "<pre>"
						+ e.target.responseText + "</pre>";
			} ;
			xhr.onerror = function(e) {
				div.innerHTML = "Drop CSV" ;
				div.classList.remove( "active" )
				document.getElementById("results").innerHTML = "<pre>"
						+ e.target.responseText + "</pre>";
			} ;
			xhr.open("POST", target);
			xhr.send(formData);			
		}
		

</script>

	</script>
</body>
</html>